<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>设置 - XBooster</title>
  <link rel="stylesheet" href="popup.css">
  <link rel="stylesheet" href="settings.css">
</head>
<body class="settings-page">
  <div class="settings-shell">
    <header class="settings-header">
      <div>
        <div class="header-kicker">XBooster</div>
        <h1>设置</h1>
        <p class="settings-subtitle">按「接口 / 回复 / 写作 / 翻译」顺序组织，避免混用变量。</p>
      </div>
    </header>

    <section class="settings-card" style="--delay: 0ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">社区</p>
          <h2>联系与反馈</h2>
        </div>
      </div>

      <div class="field-group">
        <!-- 配置教程入口 -->
        <a href="https://x.com/eggyrooch/status/2012779981777027368" target="_blank" class="tutorial-link-card">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="font-size: 28px;">📖</div>
            <div style="flex: 1;">
              <div style="font-weight: 700; font-size: 15px; margin-bottom: 3px; color: #fff;">快速配置教程</div>
              <div style="font-size: 12px; color: rgba(255, 255, 255, 0.85);">3 分钟学会配置，立即开始使用 XBooster</div>
            </div>
            <div style="font-size: 20px; color: rgba(255, 255, 255, 0.8);">→</div>
          </div>
        </a>
        
        <div class="help-text" style="margin: 16px 0; line-height: 1.6; color: #4a5568;">
          如遇问题或有功能建议，欢迎通过以下渠道联系
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <a href="https://x.com/eggyrooch" target="_blank" class="community-link-card" style="background: #2c3e50; border: 1px solid #34495e;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="font-size: 24px;">👨‍💻</div>
              <div>
                <div style="font-weight: 600; font-size: 14px; margin-bottom: 3px; color: #fff;">关注作者</div>
                <div style="font-size: 12px; color: #bdc3c7;">@eggyrooch</div>
              </div>
            </div>
          </a>
          
          <a href="https://x.com/i/communities/2009675434196160590" target="_blank" class="community-link-card" style="background: #34495e; border: 1px solid #455a64;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="font-size: 24px;">💬</div>
              <div>
                <div style="font-weight: 600; font-size: 14px; margin-bottom: 3px; color: #fff;">加入社区</div>
                <div style="font-size: 12px; color: #bdc3c7;">Bug反馈 · 功能建议</div>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <section class="settings-card" style="--delay: 60ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">接口</p>
          <h2>AI 接口配置</h2>
        </div>
      </div>

      <div class="field">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div class="help-text" style="margin: 0;">
            💡 启用多个接口会自动轮询（P1 > P2 > P3），提升稳定性
          </div>
          <button type="button" id="add-proxy-btn" class="btn-secondary" style="padding: 8px 16px; font-size: 13px;">+ 添加接口</button>
        </div>
        
        <div class="proxy-table-wrapper">
          <table class="proxy-table">
            <thead>
              <tr>
                <th style="width: 60px; text-align: center;">优先级</th>
                <th style="width: 110px;">站点</th>
                <th style="width: 220px;">API 地址</th>
                <th style="width: 180px;">模型</th>
                <th style="width: 240px;">API Key</th>
                <th style="width: 60px; text-align: center;">启用</th>
                <th style="width: 60px; text-align: center;">操作</th>
              </tr>
            </thead>
            <tbody id="proxy-table-body">
              <!-- 所有代理站行将通过JavaScript动态添加 -->
            </tbody>
          </table>
        </div>
        
        <div style="margin-top: 14px; padding: 12px 14px; background: linear-gradient(135deg, #e6f3ff 0%, #f0f7ff 100%); border-radius: 8px; border-left: 3px solid var(--accent);">
          <strong>🎁 钱多多注册：</strong>
          <a href="https://api2.aigcbest.top/register?aff=Jdcp" target="_blank" style="color: var(--accent-strong); text-decoration: none; font-weight: 600; margin-left: 4px;">立即注册获取 API Key →</a>
        </div>
      </div>
    </section>

    <section class="settings-card" style="--delay: 90ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">使用统计</p>
          <h2>批量回复日报</h2>
        </div>
      </div>
      <div class="field">
        <div id="stats-daily">加载中...</div>
        <div class="help-text">统计包含批量生成的总数/成功/失败/已填入输入框数（按日汇总）。</div>
      </div>
    </section>

    <section class="settings-card" style="--delay: 150ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">批量回复</p>
          <h2>潜力指数权重配置</h2>
        </div>
      </div>
      
      <div class="field-group">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h3>筛选条件</h3>
          <button id="reset-filters-btn" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;">恢复推荐设置</button>
        </div>
        
        <div class="field">
          <label class="toggle">
            <input type="checkbox" id="filter-verified-only" checked>
            <div>
              <div>仅回复蓝V用户</div>
              <div class="help-text">推荐开启，聚焦优质用户，提高互动质量</div>
            </div>
          </label>
        </div>
        
        <div class="field">
          <label class="toggle">
            <input type="checkbox" id="auto-like-after-reply" checked>
            <div>
              <div>回复后自动点赞</div>
              <div class="help-text">填入回复到输入框后自动为该推文点赞,默认开启</div>
            </div>
          </label>
        </div>
      </div>
      
      <div class="field-group">
        <h3>评分偏好</h3>
        <div id="scoring-summary" style="margin-bottom: 12px; padding: 12px 14px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 10px; border: 1px solid #bae6fd; font-size: 13px; line-height: 1.6;">
          <div style="font-weight: 600; margin-bottom: 6px; color: #0369a1;">📋 当前策略：</div>
          <div id="scoring-description" style="color: #334155;"></div>
        </div>
        
        <div class="field-grid">
          <div class="field">
            <label for="potential-time-weight">⏰ 时间新鲜度</label>
            <select id="potential-time-weight" class="select-input">
              <option value="0">不关心</option>
              <option value="20">稍微偏好（20）</option>
              <option value="40" selected>优先（40）⭐</option>
              <option value="50">必须（50）</option>
            </select>
          </div>
          <div class="field">
            <label for="potential-competition-weight">🎯 竞争激烈度</label>
            <select id="potential-competition-weight" class="select-input">
              <option value="0">不关心</option>
              <option value="20">稍微偏好（20）</option>
              <option value="40" selected>优先（40）⭐</option>
              <option value="50">必须（50）</option>
            </select>
          </div>
        </div>
        
        <div class="field-grid">
          <div class="field">
            <label for="potential-view-weight">👁️ 浏览量热度</label>
            <select id="potential-view-weight" class="select-input">
              <option value="0">不关心</option>
              <option value="15">稍微偏好（15）</option>
              <option value="30" selected>优先（30）⭐</option>
              <option value="40">必须（40）</option>
            </select>
          </div>
          <div class="field">
            <label for="potential-content-weight">📝 内容质量加分</label>
            <select id="potential-content-weight" class="select-input">
              <option value="0">不加分</option>
              <option value="5">轻微（5）</option>
              <option value="10" selected>正常（10）⭐</option>
              <option value="20">大幅（20）</option>
            </select>
          </div>
        </div>
        
        <div style="margin-top: 4px; font-size: 13px; color: #64748b;">
          权重总和：<span id="potential-weight-sum" style="font-weight: 600; color: #10b981;">120</span> / 120
        </div>
      </div>
      
      <div class="field-group">
        <h3>🚫 硬过滤（不满足直接 SKIP）</h3>
        <div class="field-grid">
          <div class="field">
            <label for="filter-min-views">最小浏览量</label>
            <input type="number" id="filter-min-views" min="0" max="10000" value="500" step="100">
          </div>
          <div class="field">
            <label for="filter-max-hours">最大时间（小时）</label>
            <input type="number" id="filter-max-hours" min="1" max="48" value="14" step="1">
          </div>
          <div class="field">
            <label for="filter-max-replies">最大回复数</label>
            <input type="number" id="filter-max-replies" min="10" max="500" value="180" step="10">
          </div>
        </div>
      </div>
      
      <div class="field-group">
        <h3>📊 等级阈值（120分制）</h3>
        <div class="field-grid">
          <div class="field">
            <label for="potential-must-grab-threshold">🔥 HOT（>=）→ 3条</label>
            <input type="number" id="potential-must-grab-threshold" min="0" max="120" value="95" step="1">
          </div>
          <div class="field">
            <label for="potential-strong-threshold">✨ GOOD（>=）→ 2条</label>
            <input type="number" id="potential-strong-threshold" min="0" max="120" value="80" step="1">
          </div>
          <div class="field">
            <label for="potential-try-threshold">💡 TRY（>=）→ 1条</label>
            <input type="number" id="potential-try-threshold" min="0" max="120" value="65" step="1">
          </div>
          <div class="field">
            <label for="potential-skip-threshold">⏭️ SKIP（<65）</label>
            <input type="number" id="potential-skip-threshold" min="0" max="120" value="65" step="1" disabled>
          </div>
        </div>
      </div>
      
      <div class="field">
        <button id="reset-potential-weights-btn" class="btn-secondary">重置为默认值</button>
      </div>
    </section>

    <section class="settings-card" style="--delay: 120ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">回复</p>
          <h2>评论与回复生成</h2>
        </div>
      </div>

      <div class="field-group">
        <h3>🎭 人设配置</h3>
        <div class="field-grid">
          <div class="field">
            <label for="persona-preset">预设人设</label>
            <select id="persona-preset" class="select-input">
              <option value="designer">🎨 自由设计师（审美敏锐、表达直接）</option>
              <option value="student">📚 中二高中生（热血、爱用网络梗）</option>
              <option value="otaku">🎮 二次元宅（追番、懂梗、共情强）</option>
              <option value="foodie">🍜 美食博主（热爱分享、生活化）</option>
              <option value="tech">💻 程序员（理性、简洁、偶尔吐槽）</option>
              <option value="custom">✏️ 自定义...</option>
            </select>
          </div>
          <div class="field" id="custom-persona-field" style="display: none;">
            <label for="custom-persona">自定义人设描述</label>
            <input type="text" id="custom-persona" placeholder="如：25岁摄影师，喜欢旅行和咖啡">
          </div>
        </div>
        <div class="help-text">人设影响回复风格，可用 {{persona}} 变量引用</div>
      </div>

      <div class="field-group">
        <h3>评论 / 回复统一模板</h3>
        <div class="field" id="response-vars">
          <div class="help-text">可用变量（点击插入）：</div>
          <div class="chips" id="response-var-chips"></div>
        </div>
        <div class="field">
          <label for="default-prompt-template">评论/回复提示词模板</label>
          <textarea id="default-prompt-template" rows="5" placeholder="用于弹窗评论与小老虎回复。"></textarea>
          <div class="help-text">
            所有提示词均可见，无隐藏片段；变量需在上方勾选后点击插入。<br>
            <span style="color: #64748b;">💡 提示：也可直接编辑 <code style="background: #f1f5f9; padding: 2px 6px; border-radius: 4px;">prompts/default-reply.md</code> 文件</span>
          </div>
          <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
            <button id="reset-default-template-btn" class="btn-secondary">恢复默认提示词</button>
          </div>
        </div>
        <div class="field-group">
          <div class="history-header">
            <div>
              <h4 style="margin: 0;">提示词历史</h4>
              <div class="help-text">保存/回退/删除历史提示词，便于调试与对比。</div>
            </div>
            <div class="history-header__actions">
              <button id="save-prompt-history-btn" class="btn-secondary">保存当前到历史</button>
              <button id="delete-selected-history-btn" class="btn-secondary danger">删除选中</button>
            </div>
          </div>
          <div id="prompt-history-list" class="history-list" aria-live="polite">
            <div class="history-empty">暂无历史提示词</div>
          </div>
        </div>
      </div>
    </section>

    <section class="settings-card" style="--delay: 240ms;">
      <div class="card-title-row">
        <div>
          <p class="card-kicker">书签</p>
          <h2>快速书签管理</h2>
        </div>
      </div>

      <div class="field">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <label style="margin: 0;">书签列表</label>
          <button type="button" id="add-bookmark-btn" class="btn-secondary" style="padding: 6px 12px; font-size: 13px;">+ 添加书签</button>
        </div>
        <div class="help-text" style="margin-bottom: 16px;">在弹窗中快速访问常用搜索，支持自动更新日期参数</div>
        <div class="proxy-table-wrapper">
          <table class="proxy-table">
            <thead>
              <tr>
                <th style="width: 100px;">图标</th>
                <th style="width: 140px;">名称</th>
                <th>URL</th>
                <th style="width: 100px;">自动日期</th>
                <th style="width: 60px;">操作</th>
              </tr>
            </thead>
            <tbody id="bookmark-table-body">
              <!-- 书签行将通过JavaScript动态添加 -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <details class="settings-card settings-card--collapsible" style="--delay: 270ms;">
      <summary>
        <div style="flex: 1;">
          <div style="font-weight: 600;">高级（变量开关 / 调试预览）</div>
        </div>
      </summary>
      <div class="card-body">
        <div class="field-grid">
          <label class="toggle">
            <input type="checkbox" id="include-author-handle-in-prompt">
            <div>
              <div>允许使用 {{author_handle}}</div>
              <div class="help-text">关闭后作者 handle 会替换为空。</div>
            </div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="include-tone-in-prompt">
            <div>
              <div>允许使用 {{tone}} / {{tone_label}}</div>
              <div class="help-text">关闭后语气变量会替换为空。</div>
            </div>
          </label>
        </div>

        <div class="field-group" style="margin-top: 16px;">
          <h3>写作预览（新推文）</h3>
          <div class="field-grid">
            <div class="field">
              <label for="test-compose-topic">测试主题 / 草稿（{{topic}}）</label>
              <input id="test-compose-topic" type="text" placeholder="例如：AI 助手如何改变内容创作">
            </div>
            <div class="field">
              <label for="test-compose-tone">测试语气（{{tone}}）</label>
              <input id="test-compose-tone" type="text" placeholder="supportive / snarky / optimistic ...">
            </div>
            <div class="field">
              <label for="test-compose-locale">测试语言（{{locale}}）</label>
              <input id="test-compose-locale" type="text" placeholder="zh-CN / en-US">
            </div>
          </div>
          <button id="preview-compose-btn" class="btn-secondary" style="width: 100%;">测试生成（写作预览）</button>
          <div class="field" style="margin-top: 12px;">
            <label for="preview-compose-result">写作预览结果</label>
            <textarea id="preview-compose-result" rows="4" readonly placeholder="点击后生成结果会显示在这里。"></textarea>
          </div>
        </div>

        <div class="field-group" style="margin-top: 16px;">
          <h3>回复/评论预览（真实调用 LLM）</h3>
          <div class="field-grid">
            <div class="field">
              <label for="test-response-content">测试内容（{{content}} / {{reply_content}} / {{original_post_text}}）</label>
              <textarea id="test-response-content" rows="3" placeholder="输入一段要回复/评论的内容"></textarea>
            </div>
            <div class="field">
              <label for="test-response-author-handle">测试作者 handle（{{author_handle}}）</label>
              <input id="test-response-author-handle" type="text" placeholder="@example_user">
            </div>
            <div class="field">
              <label for="test-response-tone">测试语气（{{tone}}）</label>
              <input id="test-response-tone" type="text" placeholder="supportive / snarky / optimistic ...">
            </div>
            <div class="field">
              <label for="test-response-tone-label">测试语气名称（{{tone_label}}）</label>
              <input id="test-response-tone-label" type="text" placeholder="支持 / 讽刺 / 乐观 ...">
            </div>
            <div class="field">
              <label for="test-response-lang">测试语言指令（{{lang_instruction}}）</label>
              <input id="test-response-lang" type="text" placeholder="请使用中文生成评论">
            </div>
            <div class="field">
              <label for="test-response-locale">测试语言（{{locale}}）</label>
              <input id="test-response-locale" type="text" placeholder="zh-CN / en-US">
            </div>
          </div>
          <button id="preview-response-btn" class="btn-secondary" style="width: 100%;">测试生成（回复/评论预览）</button>
          <div class="field" style="margin-top: 12px;">
            <label for="preview-response-result">回复/评论预览结果</label>
            <textarea id="preview-response-result" rows="4" readonly placeholder="点击后生成结果会显示在这里。"></textarea>
          </div>
        </div>
      </div>
    </details>

    <details class="settings-card settings-card--collapsible" style="--delay: 300ms;">
      <summary>
        <div style="flex: 1;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
            <span style="font-weight: 600;">写作功能（新推文生成）</span>
            <span style="display: inline-flex; align-items: center; padding: 3px 8px; background: rgba(251, 191, 36, 0.15); color: #d97706; border-radius: 4px; font-size: 11px; font-weight: 600; letter-spacing: 0.02em;">灰度测试</span>
          </div>
          <div class="help-text" style="font-weight: 400; font-size: 12px; line-height: 1.5;">实验性功能，尚未充分测试，不影响核心的回复生成功能，可忽略</div>
        </div>
      </summary>
      <div class="card-body">
        <div class="field">
          <label for="compose-prompt-template">写作提示词模板</label>
          <textarea id="compose-prompt-template" rows="4" placeholder="用于新推文生成，可将主题/草稿扩写成推文。&#10;支持变量：{{topic}}，{{tone}}，{{locale}}。"></textarea>
          <div class="help-text">写作只关心主题与语气，不需要作者或帖子内容。</div>
          <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
            <button id="reset-compose-template-btn" class="btn-secondary">恢复默认写作提示词</button>
          </div>
        </div>
      </div>
    </details>

    <details class="settings-card settings-card--collapsible" style="--delay: 330ms;">
      <summary>
        <div style="flex: 1;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
            <span style="font-weight: 600;">翻译功能</span>
            <span style="display: inline-flex; align-items: center; padding: 3px 8px; background: rgba(251, 191, 36, 0.15); color: #d97706; border-radius: 4px; font-size: 11px; font-weight: 600; letter-spacing: 0.02em;">灰度测试</span>
          </div>
          <div class="help-text" style="font-weight: 400; font-size: 12px; line-height: 1.5;">实验性功能，尚未充分测试，不影响核心的回复生成功能，可忽略</div>
        </div>
      </summary>
      <div class="card-body">
        <div class="field">
          <label class="toggle">
            <input type="checkbox" id="enable-translation">
            <div>
              <div>启用翻译功能</div>
              <div class="help-text">开启后生成评论会自动翻译，也支持手动翻译帖子。</div>
            </div>
          </label>
        </div>

        <div id="auto-translate-section" class="field">
          <label class="toggle">
            <input type="checkbox" id="auto-translate-post">
            <div>
              <div>自动翻译帖子（默认关闭）</div>
              <div class="help-text">读取帖子时自动翻译并展示，不勾选则仅在需要时手动翻译。</div>
            </div>
          </label>
        </div>

        <div class="field-grid">
          <div id="target-language-section" class="field">
            <label for="target-language">翻译目标语言</label>
            <select id="target-language">
              <option value="zh-CN">中文（简体）</option>
              <option value="zh-TW">中文（繁体）</option>
              <option value="en">英语</option>
              <option value="ja">日语</option>
              <option value="ko">韩语</option>
              <option value="es">西班牙语</option>
              <option value="fr">法语</option>
              <option value="de">德语</option>
              <option value="ru">俄语</option>
              <option value="pt">葡萄牙语</option>
              <option value="it">意大利语</option>
              <option value="ar">阿拉伯语</option>
            </select>
          </div>
          <div class="field">
            <label for="google-translate-api-key">Google Translate API Key（可选）</label>
            <input type="password" id="google-translate-api-key" placeholder="可选，用于翻译">
          </div>
        </div>
      </div>
    </details>

    <div class="save-bar">
      <div id="status" class="status"></div>
      <button id="save-settings-btn" class="btn-primary">保存设置</button>
    </div>
  </div>

  <script src="settings.js"></script>
</body>
</html>
